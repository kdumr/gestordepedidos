<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Franguxo Gestor de Pedidos</title>
    <style>
                :root{
                    --bg: #fbf5e9;          /* fundo em tom creme/laranja claro */
                    --panel: #ffffff;
                    --primary: #ff7a00;     /* laranja principal */
                    --primary-hover:#e56700;/* laranja mais escuro no hover */
                    --text:#2d2d2d;
                    --muted:#6a6a6a;
                    --border:#e3e6ea;
                    --accent-soft:#fff1e6;  /* laranja bem claro para áreas neutras */
                    --accent-soft-hover:#ffe3cc;
                    --link:#ff7a00;
                }
        *{ box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg);
            height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
        }
        .auth-wrapper{
            width: 940px;
            height: 560px;
            background: var(--panel);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            display: grid;
            grid-template-columns: 440px 1fr;
            overflow: hidden;
        }
        .left{
            padding: 28px 32px 24px 32px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .brand{
            display: flex;
            align-items: center;
            justify-content: center; /* centraliza o logo no topo do painel */
            gap: 10px;
            margin-bottom: 12px;
        }
        .brand-img{ max-height: 36px; width: auto; display:block; margin: 0 auto; }
        .left h2, .left .subtitle{ text-align: center; }
        .subtitle{ color: var(--muted); margin: 6px 0 20px; }

        .form-group{ margin-bottom: 14px; }
        label{ display:block; margin-bottom:6px; color:#4a4a4a; font-weight:600; }
        input[type="email"], input[type="password"], input[type="text"]{
            width:100%;
            padding:12px 12px;
            border:1px solid var(--border);
            border-radius:8px;
            font-size:14px;
        }
        .access-row{ margin-top: 6px; }
        .btn-access{
            width:100%;
            background:var(--accent-soft);
            color:#5a3a10;
            border:1px solid var(--border);
            padding:10px 12px;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
        }
        .btn-access:hover{ background:var(--accent-soft-hover); }

        .pwd-toggle{
            position:absolute; right:8px; top:50%; transform: translateY(-50%);
            background:var(--accent-soft); border:1px solid var(--border); border-radius:6px; padding:4px 8px; cursor:pointer;
            z-index: 2; pointer-events: auto; /* garante clique acima do input */
        }
        .pwd-toggle svg{ width:20px; height:20px; display:block; }
        .helper-row{ display:flex; justify-content: flex-end; margin:6px 0 2px; }
        .helper-row a{ color:var(--link); text-decoration:none; font-size: 13px; }
        .helper-row a:hover{ text-decoration: underline; }
        .btn-primary{
            width:100%; background:var(--primary); color:#fff; border:none; border-radius:8px; padding:12px; cursor:pointer; font-size:16px; font-weight:700;
        }
        .btn-primary:hover{ background: var(--primary-hover); }
    /* antiga .loading substituída por overlay full-screen */
    .loading{ display:none; text-align:center; margin-top:10px; color:#555; }
    .error{ color:#c62828; margin-top:10px; display:none; }

    /* Loading overlay */
    #loadingOverlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; }
    #loadingOverlay .loading-backdrop{ position:absolute; inset:0; background:rgba(0,0,0,0.38); }
    #loadingOverlay .loading-center{ position:relative; display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center; padding:20px; border-radius:10px; }
    #loadingOverlay .loading-svg svg{ width:56px; height:56px; }
    .hds-flight-icon--animation-loading{ animation:spin 1s linear infinite; }
    @keyframes spin{ from{ transform:rotate(0deg);} to{ transform:rotate(360deg);} }
    #loadingOverlay .loading-text{ color:#fff; font-weight:600; background:transparent; padding:6px 10px; border-radius:6px; }

        .right{
            background: linear-gradient(180deg, #fff7ed 0%, #ffe6cc 100%);
            display:flex; align-items:center; justify-content:center; padding: 24px;
        }
        .hero{
            width: 90%; height: 80%; border-radius: 16px;
            display:flex; flex-direction:column; align-items:center; justify-content:center; color:#7a3d00; font-size:24px; font-weight:700; text-align:center;
        }
        .hero-title{ margin-bottom: 12px; }
        .hero-img{ width: 80%; max-width: 420px; height: auto; display:block; }
        .hero-logo{ width: 60px; height: 60px; object-fit: contain; display:block; margin-bottom: 8px; }
    </style>
</head>
<body>
        <div class="auth-wrapper">
            <div class="left">
                        <div class="brand">
                            <img class="brand-img" src="assets/img/franguxoletra.png" alt="Franguxo" />
                        </div>
                <div class="subtitle">Gerencie seus pedidos</div>

                <form id="loginForm">

                        <div class="form-group">
                                <label for="username">E-mail *</label>
                                <input type="text" id="username" required autocomplete="username" placeholder="Seu login">
                        </div>

                        <div class="form-group">
                                <label for="password">Senha *</label>
                                                                <div class="pwd-wrap" style="position:relative;">
                                                                        <input type="password" id="password" required autocomplete="current-password" placeholder="Sua senha" style="padding-right:44px;">
                                                                        <button type="button" id="togglePwdBtn" class="pwd-toggle" aria-label="Mostrar senha" title="Mostrar senha">
                                                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9944 15.5C13.9274 15.5 15.4944 13.933 15.4944 12C15.4944 10.067 13.9274 8.5 11.9944 8.5C10.0614 8.5 8.49439 10.067 8.49439 12C8.49439 13.933 10.0614 15.5 11.9944 15.5ZM11.9944 13.4944C11.1691 13.4944 10.5 12.8253 10.5 12C10.5 11.1747 11.1691 10.5056 11.9944 10.5056C12.8197 10.5056 13.4888 11.1747 13.4888 12C13.4888 12.8253 12.8197 13.4944 11.9944 13.4944Z" fill="#0F0F0F"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 5C7.18879 5 3.9167 7.60905 2.1893 9.47978C0.857392 10.9222 0.857393 13.0778 2.1893 14.5202C3.9167 16.391 7.18879 19 12 19C16.8112 19 20.0833 16.391 21.8107 14.5202C23.1426 13.0778 23.1426 10.9222 21.8107 9.47978C20.0833 7.60905 16.8112 5 12 5ZM3.65868 10.8366C5.18832 9.18002 7.9669 7 12 7C16.0331 7 18.8117 9.18002 20.3413 10.8366C20.9657 11.5128 20.9657 12.4872 20.3413 13.1634C18.8117 14.82 16.0331 17 12 17C7.9669 17 5.18832 14.82 3.65868 13.1634C3.03426 12.4872 3.03426 11.5128 3.65868 10.8366Z" fill="#0F0F0F"></path> </g></svg>
                                                                        </button>
                                </div>
                        </div>

                        <button class="btn-primary" type="submit">Entrar</button>
                </form>

                <!-- Overlay de carregamento (substitui o texto simples) -->
                <div id="loadingOverlay" role="status" aria-live="polite" style="display:none;">
                    <div class="loading-backdrop"></div>
                    <div class="loading-center" aria-hidden="false">
                        <div class="loading-svg" aria-hidden="true">
                            <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="none" class="hds-flight-icon--animation-loading"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g fill="#ff8800" fill-rule="evenodd" clip-rule="evenodd"> <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z" opacity=".2"></path> <path d="M7.25.75A.75.75 0 018 0a8 8 0 018 8 .75.75 0 01-1.5 0A6.5 6.5 0 008 1.5a.75.75 0 01-.75-.75z"></path> </g> </g></svg>
                        </div>
                        <div class="loading-text">Conectando…</div>
                    </div>
                </div>
                <div class="error" id="error" role="alert" aria-live="polite"></div>
            </div>
                        <div class="right">
                                <div class="hero">
                                      <img class="hero-logo" src="assets/img/franguxoicon.png" alt="Franguxo Ícone" />
                                      <div class="hero-title">Gerencie seus pedidos</div>
                                      <img class="hero-img" src="assets/img/franguxocaixa.png" alt="Franguxo Caixa" />
                                </div>
                        </div>
        </div>

    <script>
        // Acessa APIs do Electron com fallback seguro para evitar quebras caso o preload não carregue
        const api = window.electronAPI || {};
        const login = typeof api.login === 'function' ? api.login : async () => ({ success:false, message:'API indisponível' });
        const openExternal = typeof api.openExternal === 'function' ? api.openExternal : (url) => {
            try{ window.open(url, '_blank'); }catch(_){ /* noop */ }
        };

        // Loading overlay + timeout
        const LOADING_TIMEOUT_MS = 15000; // 15 segundos
        let __loadingTimer = null;
        function showLoading(){
            const ov = document.getElementById('loadingOverlay');
            if(!ov) return;
            ov.style.display = 'flex';
            // desabilita inputs básicos
            try{
                document.getElementById('username').disabled = true;
                document.getElementById('password').disabled = true;
                document.querySelectorAll('#loginForm button').forEach(b=>b.setAttribute('aria-disabled','true'));
            }catch(e){/* noop */}
            // inicia timeout que mostra erro de tempo esgotado
            __loadingTimer = setTimeout(()=>{
                __loadingTimer = null;
                ov.style.display = 'none';
                try{
                    document.getElementById('username').disabled = false;
                    document.getElementById('password').disabled = false;
                    document.querySelectorAll('#loginForm button').forEach(b=>b.removeAttribute('aria-disabled'));
                }catch(e){/* noop */}
                const errEl = document.getElementById('error');
                errEl.textContent = 'Tempo de conexão esgotado. Tente novamente.';
                errEl.style.display = 'block';
            }, LOADING_TIMEOUT_MS);
        }
        function hideLoading(){
            const ov = document.getElementById('loadingOverlay');
            if(ov) ov.style.display = 'none';
            if(__loadingTimer){ clearTimeout(__loadingTimer); __loadingTimer = null; }
            try{
                document.getElementById('username').disabled = false;
                document.getElementById('password').disabled = false;
                document.querySelectorAll('#loginForm button').forEach(b=>b.removeAttribute('aria-disabled'));
            }catch(e){/* noop */}
        }

        // (Removido) Validação de email — agora aceitamos qualquer texto no login

                // Link "Esqueci a senha" (só registra se existir no DOM)
                (function(){
                        const forgot = document.getElementById('forgotLink');
                        if(!forgot) return;
                        forgot.addEventListener('click', function (e) {
                            e.preventDefault();
                            // Abre a página padrão de recuperação do WordPress no navegador
                            openExternal('https://dev.franguxo.app.br/wp-login.php?action=lostpassword');
                        });
                })();

                        // (Opcional) Botão de chave de acesso - placeholder visual (só se existir no HTML)
                        document.addEventListener('DOMContentLoaded', function(){
                            const btn = document.getElementById('accessKeyBtn');
                            if(btn){
                                btn.addEventListener('click', function(e){
                                    e.preventDefault();
                                    const keyEl = document.getElementById('accessKey');
                                    const key = (keyEl ? keyEl.value : '').trim();
                                    if(!key){
                                        alert('Informe sua chave de acesso ou utilize e-mail e senha.');
                                        return;
                                    }
                                    alert('Login por chave de acesso ainda não está habilitado neste app. Utilize e-mail e senha.');
                                });
                            }
                        });

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            // Não validar formato de email: campo aceita qualquer texto

            if (!password) {
                document.getElementById('error').textContent = 'Por favor, digite sua senha';
                document.getElementById('error').style.display = 'block';
                document.getElementById('password').focus();
                return;
            }

            showLoading();
            document.getElementById('error').style.display = 'none';

            try {
                const result = await login(username, password);
                if (!result.success) {
                    const codeRaw = (result && (result.code ?? result.error ?? result.error_code ?? result.status)) ?? '';
                    const code = String(codeRaw).toLowerCase();
                    const msgRaw = (result && (result.message ?? result.error)) ?? '';
                    const msgNorm = String(msgRaw).toLowerCase();

                    const isInvalidCred = (
                        code === 'invalid_credentials' ||
                        code === 'invalid-credentials' ||
                        code === 'unauthorized' ||
                        code === 'auth_failed' ||
                        code === '401' ||
                        (code.includes('invalid') && code.includes('credential')) ||
                        msgNorm.includes('invalid credentials') ||
                        msgNorm.includes('credenciais inválidas') ||
                        msgNorm.includes('unauthorized')
                    );

                    const message = isInvalidCred
                        ? 'Credenciais inválidas. Verifique seu email e senha.'
                        : ((result && result.message) || 'Falha no login');

                    const errEl = document.getElementById('error');
                    errEl.textContent = message;
                    errEl.style.display = 'block';
                }
                // On success, window will close automatically
            } catch (err) {
                document.getElementById('error').textContent = 'Erro ao fazer login';
                document.getElementById('error').style.display = 'block';
            } finally {
                hideLoading();
            }
        });

                                // Mostrar/ocultar senha com ícones SVG
                                document.addEventListener('DOMContentLoaded', function(){
                                    const btn = document.getElementById('togglePwdBtn');
                                    const pwd = document.getElementById('password');
                                    if(!btn || !pwd) return;

                                    const openIcon = `
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9944 15.5C13.9274 15.5 15.4944 13.933 15.4944 12C15.4944 10.067 13.9274 8.5 11.9944 8.5C10.0614 8.5 8.49439 10.067 8.49439 12C8.49439 13.933 10.0614 15.5 11.9944 15.5ZM11.9944 13.4944C11.1691 13.4944 10.5 12.8253 10.5 12C10.5 11.1747 11.1691 10.5056 11.9944 10.5056C12.8197 10.5056 13.4888 11.1747 13.4888 12C13.4888 12.8253 12.8197 13.4944 11.9944 13.4944Z" fill="#0F0F0F"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 5C7.18879 5 3.9167 7.60905 2.1893 9.47978C0.857392 10.9222 0.857393 13.0778 2.1893 14.5202C3.9167 16.391 7.18879 19 12 19C16.8112 19 20.0833 16.391 21.8107 14.5202C23.1426 13.0778 23.1426 10.9222 21.8107 9.47978C20.0833 7.60905 16.8112 5 12 5ZM3.65868 10.8366C5.18832 9.18002 7.9669 7 12 7C16.0331 7 18.8117 9.18002 20.3413 10.8366C20.9657 11.5128 20.9657 12.4872 20.3413 13.1634C18.8117 14.82 16.0331 17 12 17C7.9669 17 5.18832 14.82 3.65868 13.1634C3.03426 12.4872 3.03426 11.5128 3.65868 10.8366Z" fill="#0F0F0F"></path> </g></svg>`;

                                    const closedIcon = `
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4.4955 7.44088C3.54724 8.11787 2.77843 8.84176 2.1893 9.47978C0.857392 10.9222 0.857393 13.0778 2.1893 14.5202C3.9167 16.391 7.18879 19 12 19C13.2958 19 14.4799 18.8108 15.5523 18.4977L13.8895 16.8349C13.2936 16.9409 12.6638 17 12 17C7.9669 17 5.18832 14.82 3.65868 13.1634C3.03426 12.4872 3.03426 11.5128 3.65868 10.8366C4.23754 10.2097 4.99526 9.50784 5.93214 8.87753L4.4955 7.44088Z" fill="#0F0F0F"></path> <path d="M8.53299 11.4784C8.50756 11.6486 8.49439 11.8227 8.49439 12C8.49439 13.933 10.0614 15.5 11.9944 15.5C12.1716 15.5 12.3458 15.4868 12.516 15.4614L8.53299 11.4784Z" fill="#0F0F0F"></path> <path d="M15.4661 12.4471L11.5473 8.52829C11.6937 8.50962 11.8429 8.5 11.9944 8.5C13.9274 8.5 15.4944 10.067 15.4944 12C15.4944 12.1515 15.4848 12.3007 15.4661 12.4471Z" fill="#0F0F0F"></path> <path d="M18.1118 15.0928C19.0284 14.4702 19.7715 13.7805 20.3413 13.1634C20.9657 12.4872 20.9657 11.5128 20.3413 10.8366C18.8117 9.18002 16.0331 7 12 7C11.3594 7 10.7505 7.05499 10.1732 7.15415L8.50483 5.48582C9.5621 5.1826 10.7272 5 12 5C16.8112 5 20.0833 7.60905 21.8107 9.47978C23.1426 10.9222 23.1426 13.0778 21.8107 14.5202C21.2305 15.1486 20.476 15.8603 19.5474 16.5284L18.1118 15.0928Z" fill="#0F0F0F"></path> <path d="M2.00789 3.42207C1.61736 3.03155 1.61736 2.39838 2.00789 2.00786C2.39841 1.61733 3.03158 1.61733 3.4221 2.00786L22.0004 20.5862C22.391 20.9767 22.391 21.6099 22.0004 22.0004C21.6099 22.3909 20.9767 22.3909 20.5862 22.0004L2.00789 3.42207Z" fill="#0F0F0F"></path> </g></svg>`;

                                    // Garante que o ícone reflita o estado inicial (password oculto)
                                    btn.innerHTML = openIcon;

                                    const toggle = (e) => {
                                        if(e) e.preventDefault();
                                        const isText = pwd.type === 'text';
                                        pwd.type = isText ? 'password' : 'text';
                                        btn.innerHTML = isText ? openIcon : closedIcon;
                                        btn.setAttribute('aria-label', isText ? 'Mostrar senha' : 'Ocultar senha');
                                        btn.title = isText ? 'Mostrar senha' : 'Ocultar senha';
                                    };

                                    btn.addEventListener('click', toggle);
                                    btn.addEventListener('keydown', (e) => {
                                        if(e.key === 'Enter' || e.key === ' '){ toggle(e); }
                                    });
                                });
    </script>
</body>
</html>