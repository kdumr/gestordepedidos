<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Configurar Impressão</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .container { padding: 24px; }
    button { padding: 8px 16px; font-size: 16px; }
    header { background: #f5f5f5; padding: 12px; border-bottom: 1px solid #ddd; }
    nav { margin-bottom: 24px; }
    nav ul { list-style: none; padding: 0; margin: 0; display: flex; }
    nav li { margin-right: 24px; }
    nav a { text-decoration: none; color: #333; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="#">Arquivo</a></li>
      </ul>
    </nav>
  </header>
  <div class="container">
    <h2>Configuração de Impressão</h2>
    <h3>Impressoras Disponíveis</h3>
    <select id="printersSelect">
      <option>Carregando...</option>
    </select>
    <button id="btnSalvar">Salvar Configuração</button>
    <script>
      async function loadPrinters() {
        try {
          const response = await fetch('http://127.0.0.1:3420/printers');
          const data = await response.json();
          if (data.ok && data.printers) {
            const select = document.getElementById('printersSelect');
            select.innerHTML = '<option value="">Selecione uma impressora</option>' + data.printers.map(p => '<option value="' + (p.name || p) + '">' + (p.name || p) + '</option>').join('');
            // Load saved printer
            try {
              const config = await window.electronAPI.loadConfig();
              if (config.printer) {
                select.value = config.printer;
              }
            } catch (e) {
              console.warn('Erro ao carregar config:', e);
            }
          } else {
            document.getElementById('printersSelect').innerHTML = '<option>Erro ao carregar</option>';
          }
        } catch (e) {
          document.getElementById('printersSelect').innerHTML = '<option>Erro: ' + e.message + '</option>';
        }
      }
      loadPrinters();
      document.getElementById('btnSalvar').onclick = async function() {
        const selected = document.getElementById('printersSelect').value;
        if (selected) {
          try {
            await window.electronAPI.savePrinter(selected);
            alert('Impressora salva com sucesso!');
          } catch (e) {
            alert('Erro ao salvar: ' + e.message);
          }
        } else {
          alert('Selecione uma impressora primeiro.');
        }
      };
    </script>
  </div>
</body>
</html>
